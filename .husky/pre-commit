#!/bin/sh

echo ""
echo "========================================"
echo "       PRE-COMMIT QUALITY GATE          "
echo "========================================"
echo ""

# Step 1: lint-staged (ESLint + Prettier on staged files only)
echo "Step 1/2: Running lint-staged..."
npx lint-staged
if [ $? -ne 0 ]; then
  echo ""
  echo "FAIL: lint-staged failed - fix errors above before committing"
  exit 1
fi
echo "OK: lint-staged passed"
echo ""

# Step 2: Braid core tests
echo "Step 2/2: Running Braid core tests..."
BRAID_CORE="braid-llm-kit/core"
if [ -d "$BRAID_CORE" ] && ls "$BRAID_CORE"/*.test.js >/dev/null 2>&1; then
  node --test "$BRAID_CORE"/*.test.js
  if [ $? -ne 0 ]; then
    echo ""
    echo "FAIL: Braid core tests failed - fix errors above before committing"
    exit 1
  fi
  echo "OK: Braid core tests passed"
else
  echo "SKIP: No Braid core test files found"
fi
echo ""

echo "========================================"
echo "       PRE-COMMIT CHECKS PASSED         "
echo "========================================"
echo ""
