# PEP Capability Catalog
# Maps abstract capability names to AiSHA CRM tool bindings.
# Capabilities are platform-agnostic — bindings are AiSHA-specific.
# Add new capabilities here when extending PEP to new domains.
# Human-authored — YAML preferred over JSON for readability and comments.

version: "1.0.0"
capabilities:
  - id: persist_entity
    abstract: StoreRecord
    description: Create or update a business entity record
    bindings:
      CashFlowTransaction:
        create:
          braid_tool: createCashFlowTransaction
          http: POST /api/cashflow
        update:
          braid_tool: updateCashFlowTransaction
          http: PUT /api/cashflow/:id
    effects: ["!net"]
    policy: WRITE_OPERATIONS

  - id: read_entity
    abstract: ReadRecord
    description: Read or list business entity records
    bindings:
      CashFlowTransaction:
        list:
          braid_tool: listCashFlowTransactions
          http: GET /api/cashflow
        get:
          braid_tool: getCashFlowTransaction
          http: GET /api/cashflow/:id
    effects: ["!net"]
    policy: READ_ONLY

  - id: notify_role
    abstract: SendMessage
    description: Notify a role or actor about an event
    bindings:
      owner:
        braid_tool: notifyOwner
        http: POST /api/notifications
      manager:
        braid_tool: notifyManager
        http: POST /api/notifications
    effects: ["!net"]
    policy: WRITE_OPERATIONS

  - id: compute_next_date
    abstract: TimeCalculation
    description: Calculate the next occurrence date from a recurrence pattern
    bindings:
      weekly:
        duration: P7D   # ISO-8601: 7 days
      monthly:
        duration: P1M   # ISO-8601: 1 month
      quarterly:
        duration: P3M   # ISO-8601: 3 months
      annually:
        duration: P1Y   # ISO-8601: 1 year
    effects: ["!clock"]
    policy: READ_ONLY

  # ── Phase 3 ──────────────────────────────────────────────────────────────────

  - id: query_entity
    abstract: QueryRecords
    description: Execute a read-only filtered query against a CRM entity or view
    bindings:
      Lead:
        http: POST /api/pep/query
      Contact:
        http: POST /api/pep/query
      Opportunity:
        http: POST /api/pep/query
      Account:
        http: POST /api/pep/query
      Activity:
        http: POST /api/pep/query
      BizDevSource:
        http: POST /api/pep/query
      v_crm_records:
        http: POST /api/pep/query
      v_account_related_people:
        http: POST /api/pep/query
      lead_detail_full:
        http: POST /api/pep/query
      v_activity_stream:
        http: POST /api/pep/query
      v_opportunity_pipeline_by_stage:
        http: POST /api/pep/query
    effects: ["!net"]
    policy: READ_ONLY
    output:
      assign: results
      shape: "{ rows: array, count: number, target: string, executed_at: string }"
