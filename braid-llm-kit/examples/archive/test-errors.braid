// Test file with intentional errors for validator demo

import { Result, Lead, CRMError } from "../../spec/types.braid"

// ERROR 1: Function uses http.get but doesn't declare !net effect
fn fetchLead(id: String) -> Result<Lead, CRMError> {
  let url = "/api/v2/leads/" + id;
  let response = http.get(url);
  
  return match response {
    Ok{value} => Ok(value.data),
    Err{error} => Err(NetworkError{ url: url, code: error.status })
  };
}

// ERROR 2: Uses null instead of Option
fn getMaybe(id: String) -> Result<Lead, CRMError> !net {
  let fallback = null;
  return http.get("/api/leads/" + id);
}

// ERROR 3: CRM function missing tenant_id parameter
fn createLead(name: String, email: String) -> Result<Lead, CRMError> !net {
  let payload = { name: name, email: email };
  let response = http.post("/api/v2/leads", { body: payload });
  
  return match response {
    Ok{value} => Ok(value.data),
    Err{error} => Err(NetworkError{ url: "/api/v2/leads", code: error.status })
  };
}

// ERROR 4: Uses clock.now() without !clock effect
fn createWithTime(tenant_id: String) -> Result<Lead, CRMError> !net {
  let timestamp = clock.now();
  let payload = { tenant_id: tenant_id, created_at: timestamp };
  let response = http.post("/api/v2/leads", { body: payload });
  
  return match response {
    Ok{value} => Ok(value.data),
    Err{error} => Err(NetworkError{ url: "/api/v2/leads", code: error.status }),
    _ => Err(NetworkError{ url: "/api/v2/leads", code: 500 })
  };
}

// GOOD: This one should have no errors
fn searchLeads(query: String) -> Result<Array<Lead>, CRMError> !net {
  let url = "/api/v2/leads/search?q=" + query;
  let response = http.get(url);
  
  return match response {
    Ok{value} => Ok(value.data),
    Err{error} => Err(NetworkError{ url: url, code: error.status }),
    _ => Err(NetworkError{ url: url, code: 500 })
  };
}
