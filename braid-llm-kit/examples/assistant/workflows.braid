// Executive Assistant Tools - Workflow Template Management
// List available templates and instantiate workflows from them

import { Result, CRMError } from "../../spec/types.braid"

// List all available workflow templates
@policy(READ_ONLY)
fn listWorkflowTemplates(
  tenant_id: String,
  category: String
) -> Result<Array, CRMError> !net {
  let url = "/api/workflow-templates";
  let params = {
    tenant_id: tenant_id,
    is_active: true,
    category: category
  };
  
  let response = http.get(url, { params: params });
  
  return match response {
    Ok{value} => Ok(value.data),
    Err{error} => Err({ tag: "NetworkError", url: url, code: error.status }),
    _ => Err({ tag: "NetworkError", url: url, code: 500 })
  };
}

// Get detailed information about a specific template
@policy(READ_ONLY)
fn getWorkflowTemplate(
  tenant_id: String,
  template_id: String
) -> Result<Object, CRMError> !net {
  let url = "/api/workflow-templates/" + template_id;
  let params = { tenant_id: tenant_id };
  
  let response = http.get(url, { params: params });
  
  return match response {
    Ok{value} => Ok(value.data),
    Err{error} => Err({ tag: "NetworkError", url: url, code: error.status }),
    _ => Err({ tag: "NetworkError", url: url, code: 500 })
  };
}

// Instantiate a workflow from a template with provided parameters
@policy(WRITE_OPERATIONS)
fn instantiateWorkflowTemplate(
  tenant_id: String,
  template_id: String,
  workflow_name: String,
  parameters: Object
) -> Result<Object, CRMError> !net {
  let url = "/api/workflow-templates/" + template_id + "/instantiate";
  let payload = {
    tenant_id: tenant_id,
    workflow_name: workflow_name,
    parameters: parameters
  };
  
  let response = http.post(url, { body: payload });
  
  return match response {
    Ok{value} => Ok(value.data),
    Err{error} => Err({ tag: "NetworkError", url: url, code: error.status }),
    _ => Err({ tag: "NetworkError", url: url, code: 500 })
  };
}
