// Suggest Next Actions Braid Function
// RAG-enabled analysis of entity state to provide intelligent next step recommendations
// Analyzes: recent notes, activities, stage, last contact date, temperature, best practices

import { Result, CRMError } from "../../spec/types.braid"

@policy(READ_ONLY)
fn suggestNextActions(
  tenant: String,
  entity_type: String,
  entity_id: String,
  limit: Number
) -> Result<NextActionsSuggestion, CRMError> !net {
  // Analyze entity and suggest next actions using RAG memory + rule-based logic
  // Entity types: lead, contact, account, opportunity
  // Returns 2-3 prioritized actionable suggestions with reasoning
  
  let url = "/api/ai/suggest-next-actions";
  let body = {
    tenant_id: tenant,
    entity_type: entity_type,
    entity_id: entity_id,
    limit: limit
  };
  
  let response = http.post(url, { body: body });
  
  return match response {
    Ok{value} => Ok(value.data),
    Err{error} => CRMError.fromHTTP(url, error.status, "suggest_next_actions"),
    _ => CRMError.network(url, 500, "unknown")
  };
}
