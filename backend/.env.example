# Aisha CRM Backend Server Configuration - PRODUCTION TEMPLATE
# Copy this to .env and fill in your actual values
# DO NOT commit .env files to git - they contain secrets!

# ========================================
# ENVIRONMENT
# ========================================
PORT=3001
NODE_ENV=development  # Set to 'production' in deployment

# ========================================
# JWT AUTHENTICATION (REQUIRED)
# ========================================
# Generate a strong secret with:
#   node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
# Minimum 32 characters required for production
JWT_SECRET=your_super_secret_jwt_key_change_this_to_random_64_chars

# ========================================
# SUPABASE CONFIGURATION (REQUIRED)
# ========================================
# Get these from your Supabase project settings â†’ API

# Supabase Project URL
SUPABASE_URL=https://your-project.supabase.co

# Supabase Anonymous/Public Key (safe to expose in frontend)
SUPABASE_ANON_KEY=your_supabase_publishable_anon_key

# Supabase Service Role Key (SECRET - never expose or commit!)
# This key bypasses Row Level Security - backend use only
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key_secret

# ========================================
# SUPABASE API MODE (RECOMMENDED)
# ========================================
# Set to true to use Supabase PostgREST API (HTTP) instead of direct PostgreSQL
# This avoids IPv6 connection issues with Docker
USE_SUPABASE_PROD=true

# ========================================
# LEGACY DATABASE (Only if not using Supabase API)
# ========================================
# Leave commented out if USE_SUPABASE_PROD=true
# DATABASE_URL=postgresql://user:password@localhost:5432/aishacrm
# POSTGRES_HOST=localhost
# POSTGRES_PORT=5432
# POSTGRES_DB=aishacrm
# POSTGRES_USER=postgres
# POSTGRES_PASSWORD=your_password
# DB_SSL=true

# ========================================
# STORAGE
# ========================================
# Supabase Storage bucket for tenant assets (create in Supabase dashboard)
SUPABASE_STORAGE_BUCKET=tenant-assets

# ========================================
# USER MANAGEMENT
# ========================================
# DEPRECATED: Do not use a default password in production!
# Generate random passwords per user or use passwordless auth:
#   const tempPassword = crypto.randomBytes(16).toString('base64');
# Send via secure channel (email, SMS) with forced password reset
# DEFAULT_USER_PASSWORD=DEPRECATED_DO_NOT_USE

# ========================================
# SECURITY & MIDDLEWARE (OPTIONAL)
# ========================================
# JWT Token Expiration
JWT_EXPIRES_IN=24h

# Rate Limiting
API_RATE_LIMIT_WINDOW_MS=60000  # 1 minute
API_RATE_LIMIT_MAX_REQUESTS=100  # Max requests per window

# CORS - Add production frontend URL
ALLOWED_ORIGINS=http://localhost:5173,http://localhost:3000

# ========================================
# DATA MIGRATION (OPTIONAL - Base44 sync only)
# ========================================
BASE44_APP_ID=68f83fa997417472c872be53
BASE44_API_KEY=your_base44_api_key

# ========================================
# WORKFLOW AUTOMATION (OPTIONAL)
# ========================================
N8N_API_KEY=your_n8n_api_key_here

# ========================================
# AI SERVICES (OPTIONAL)
# ========================================
OPENAI_API_KEY=your_openai_api_key

# ========================================
# PAYMENT & BILLING (OPTIONAL - Stripe)
# ========================================
STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_signing_secret

# ========================================
# TELEPHONY (OPTIONAL)
# ========================================
# Twilio
TWILIO_ACCOUNT_SID=your_twilio_sid
TWILIO_AUTH_TOKEN=your_twilio_token

# SignalWire
SIGNALWIRE_PROJECT_ID=your_signalwire_project
SIGNALWIRE_API_TOKEN=your_signalwire_token

# ========================================
# MICROSOFT INTEGRATION (OPTIONAL)
# ========================================
# Microsoft Graph API for Office 365, Outlook, Teams
MICROSOFT_CLIENT_ID=your_client_id
MICROSOFT_CLIENT_SECRET=your_client_secret
MICROSOFT_TENANT_ID=your_tenant_id

# ========================================
# GOOGLE INTEGRATION (OPTIONAL)
# ========================================
# Google Workspace, Calendar, Gmail
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret

# ========================================
# ALTERNATIVE STORAGE (OPTIONAL)
# ========================================
# MinIO (S3-compatible)
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_USE_SSL=false

# Cloudflare R2 (S3-compatible)
R2_ACCOUNT_ID=your_cloudflare_account_id
R2_ACCESS_KEY_ID=your_r2_access_key
R2_SECRET_ACCESS_KEY=your_r2_secret_key

# ========================================
# GITHUB MODEL CONTEXT PROTOCOL (OPTIONAL)
# ========================================
# If set, backend will expose a 'GitHub MCP' server at /api/mcp/servers
GITHUB_TOKEN=ghp_your_token_here

# ========================================
# PRODUCTION DEPLOYMENT CHECKLIST
# ========================================
# Before deploying to production:
#
# 1. ROW LEVEL SECURITY (RLS):
#    - Apply backend/migrations/999_enable_rls_policies.sql to your Supabase database
#    - Verify with: SELECT tablename, rowsecurity FROM pg_tables WHERE schemaname='public';
#    - Test: Direct anon key access should return no rows; backend API should work normally
#
# 2. SECRETS MANAGEMENT:
#    - Generate new JWT_SECRET: node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
#    - Rotate all Supabase keys (create new service_role key in dashboard)
#    - Use platform secret management (Railway Secrets, Vercel Environment Variables)
#    - NEVER commit .env files to git
#
# 3. ENVIRONMENT VARIABLES:
#    - Set NODE_ENV=production
#    - Update ALLOWED_ORIGINS to production domain(s)
#    - Remove DEFAULT_USER_PASSWORD or use secure random generation
#
# 4. DATABASE:
#    - Run all migrations in backend/migrations/ in order
#    - Verify RLS policies are enabled and working
#    - Set up automated backups in Supabase dashboard
#
# 5. MONITORING:
#    - Enable Supabase logging and monitoring
#    - Set up error tracking (Sentry, LogRocket, etc.)
#    - Configure health check endpoint monitoring
#
# 6. SECURITY MIDDLEWARE:
#    - Verify helmet.js is configured (HTTP security headers)
#    - Confirm rate limiting is active
#    - Test CORS configuration with production frontend
#
# 7. SECRET ROTATION:
#    - Plan rotation schedule for JWT_SECRET, API keys, database credentials
#    - Document rotation procedures for team
#    - Test rotation process in staging before production
