# ============================================
# AISHA CRM - PRODUCTION ENVIRONMENT TEMPLATE
# VPS: 147.189.173.237 with Cloudflare Tunnel
# ============================================
# WARNING: Do NOT put real secrets here. Use Doppler for secret management.
# Copy this file to .env.production and fill in real values from Doppler.

# ============================================
# ENVIRONMENT
# ============================================
NODE_ENV=production

# ============================================
# FRONTEND URLS (Cloudflare Tunnel)
# ============================================
# Frontend domain
FRONTEND_URL=https://app.aishacrm.com

# CORS - Remove localhost:4000 if not needed for testing
ALLOWED_ORIGINS=https://app.aishacrm.com

# Backend API URL - includes /api because Cloudflare routes /api/* to backend
VITE_AISHACRM_BACKEND_URL=https://app.aishacrm.com/api

# ============================================
# DATABASE (Supabase PROD)
# ============================================
USE_SUPABASE_PROD=true
SUPABASE_URL=<from-doppler>
SUPABASE_SERVICE_ROLE_KEY=<from-doppler>
SUPABASE_ANON_KEY=<from-doppler>
SUPABASE_STORAGE_BUCKET=tenant-assets
DB_SSL=true

# Legacy DATABASE_URL (kept for compatibility, but USE_SUPABASE_PROD=true uses REST API)
DATABASE_URL=<from-doppler>

# ============================================
# FRONTEND ENVIRONMENT VARIABLES
# (Injected at runtime by frontend-entrypoint.sh)
# ============================================
VITE_SUPABASE_URL=<from-doppler>
VITE_SUPABASE_ANON_KEY=<from-doppler>
VITE_SUPABASE_PUBLISHABLE_KEY=<from-doppler>

# ============================================
# SECURITY & AUTHENTICATION
# ============================================
SESSION_SECRET=<from-doppler>
JWT_SECRET=<from-doppler>
# IMPORTANT: Set COOKIE_DOMAIN if using subdomains (e.g., api.aishacrm.com and app.aishacrm.com)
# Use .aishacrm.com (with leading dot) to share cookies across all *.aishacrm.com subdomains
# Leave unset if frontend and backend are on the same domain (recommended: app.aishacrm.com/api)
# COOKIE_DOMAIN=.aishacrm.com

# ============================================
# INTRUSION DETECTION & RESPONSE (IDR)
# ============================================
IDR_ENABLED=false
IDR_DEBUG=false
# Whitelist: VPS IP + IPv6 range (bypasses all IDR checks)
IDR_WHITELIST_IPS=147.189.173.237,2a09:bac5:6c1a:2678::/64
# Emergency unblock secret (for /api/security/emergency-unblock)
IDR_EMERGENCY_SECRET=<from-doppler>

# ============================================
# RATE LIMITING
# ============================================
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=500

# ============================================
# PRODUCTION SAFETY GUARDS
# ============================================
# Disabled to allow full production functionality
PRODUCTION_SAFETY_GUARD_ENABLED=false
ALLOW_PRODUCTION_WRITES=true

# ============================================
# REDIS CONNECTIONS (Docker network)
# ============================================
REDIS_MEMORY_URL=redis://redis-memory:6379
REDIS_CACHE_URL=redis://redis-cache:6379

# ============================================
# BRAID MCP SERVER
# ============================================
MCP_SECRET=<from-doppler>
MCP_PORT=4002
# Docker network - backend container accessible as aishacrm-backend
CRM_BACKEND_URL=http://aishacrm-backend:3001
USE_DIRECT_SUPABASE_ACCESS=true

# ============================================
# SYSTEM LOGS & BATCHING
# ============================================
VITE_SYSTEM_LOG_LEVEL=ERROR
VITE_SYSTEM_LOG_BATCH_INTERVAL_MS=2000
VITE_SYSTEM_LOG_MAX_BATCH=25

# ============================================
# HEARTBEATS
# ============================================
VITE_USER_HEARTBEAT_INTERVAL_MS=90000
HEARTBEAT_INTERVAL_MS=120000
HEARTBEAT_ENABLED=true

# ============================================
# N8N AUTOMATION
# ============================================
N8N_USER=<from-doppler>
N8N_PASSWORD=<from-doppler>
# N8N_HOST=localhost
# N8N_WEBHOOK_URL=http://localhost:5678

# ============================================
# OPENAI (AI Features)
# ============================================
OPENAI_API_KEY=<from-doppler>

# ============================================
# EMAIL/SMS (Optional)
# ============================================
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=<from-doppler>
SMTP_PASS=<from-doppler>
# TWILIO_ACCOUNT_SID=your-sid
# TWILIO_AUTH_TOKEN=your-token

# ============================================
# NOTES
# ============================================
# - Cloudflare Tunnel routes:
#   - app.aishacrm.com → localhost:4000 (frontend)
#   - app.aishacrm.com/api/* → localhost:4001 (backend)
# - Docker containers:
#   - aishacrm-frontend: port 4000:3000
#   - aishacrm-backend: port 4001:3001
# - Backend URL includes /api path for Cloudflare routing
# - VITE_ variables are injected into frontend at runtime
